\\ miscellaneous words                                 cas202007                                                                this file contains words that are frequently used but do not    fit into any of the other source files                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \ Loadscreen for misc tools                      cas  21july2020                                                                Onlyforth                                                                                                                       1 2  +thru                                                                                                                      ' .blk Is .status                                                                                                                                                                               \ 3 +load   setvec                                                                                                                                                                                                                                                                                                                                                                                                                                              \ common used words                              cas  21july2020                                                                : >absaddr   ( addr -- abs_laddr )       0  forthstart d+ ;                                                                     : .blk     ( -- )         blk @   ?dup   0= ?exit                    dup 1 =  IF  cr file?  THEN   ."  Blk " . ?cr ;                                                                            : abort(  ( f -- )                                                 IF  [compile] .(  true abort"  !"  THEN  [compile] ( ;                                                                       \needs arguments   abort( use definition in FILEINT.SCR)                                                                                                                                                                                                                                                                                                                                        \ more common word definitions                   cas  21july2020                                                                | Create: cpull                                                       rp@ count  2dup + even rp!  r> swap cmove ;                                                                               : cpush  ( addr len --)   r> -rot  over >r                            rp@ over 2+ -  even dup rp!  place  cpull >r  >r ;                                                                                                                                        : bell                           7 con! ;                       : blank    ( addr count -- )     bl fill ;                                                                                                                                                                                                                                                                                                                                                      \ disable TOS alerts                             cas  21july2020                                                                Create oldvec   4 allot                                                                                                         Label newvector                                                    -8 D1 cmpi  0<> IF  -&13 D1 cmpi  0<>  IF                         .l oldvec pcrel) A2 move   A2 ) jmp   THEN  THEN              .l D1 D0 move   rts   end-code                                                                                               : setvec    $0.0404 l2@  oldvec 2!                                          newvector >absaddr   $0.0404 l2! ;                                                                                  : restvec   oldvec 2@ $0.0404 l2! ;                                                                                             : bye       restvec bye ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \ Loadscreen fÅr Diverses                              26oct86we                                                                setzt Searchorder auf     FORTH FORTH ONLY    FORTH                                                                             kompiliert die nÑchsten 2 Screens.                                                                                              .STATUS ist ein 'deferred word', das jeweils beim Kompilieren    eines Quelltextscreens aufgerufen wird.                                                                                        Screen 4 wird nicht mitkompiliert, denn SETVEC muû nach jedem    Neustart wieder aufgerufen werden. Falls Sie diese Funktion     nutzen wollen, mÅssen Sie nach jedem Laden SETVEC eingeben.     (Dazu muû natÅrlich Screen 4 kompiliert worden sein.)                                                                                                                                                                                                          \ HÑufig benutzte Definitionen                         26oct86we                                                                >ABSADDR    rechnet eine - relative- Adresse im FORTH-System in             eine absolute 32-Bit-Adresse um.                    .BLK        gibt die Nummer des gerade kompilierten Screens aus,            bei Screen 1 auch den Filenamen.                                                                                    ABORT(      bewirkt das gleiche wie ABORT", ist aber im Direkt-             modus zulÑssig.                                                                                                     ARGUMENTS   prÅft, ob eine bestimmte (Mindest-)Anzahl von Werten            auf dem Stack liegt. Dieses Wort ist bereits im                 FORTHKER.PRG vorhanden, da es vom File-Interface                gebraucht wird.                                                                                                                                                                     \ HÑufig benutzte Definitionen II                      26oct86we                                                                CPUSH       sorgt im Zusammenspiel mit CPULL dafÅr, daû ein                 String (bzw. ein beliebiger Speicherbereich, z.B.               ein Array) nach dem Aufruf einer Funktion wieder                die alten Werte erhÑlt. Entspricht dem Wort PUSH,               aber fÅr Strings anstelle von Variablen.                                                                                                                                            BELL        Dieses Wort ist selbsterklÑrend !!!                 BLANK       fÅllt ab addr count Speicherstellen mit Leerzeichen.                                                                                                                                                                                                                                                                                                                                \ TOS-Alerts abschalten                                26oct86we                                                                Vielleicht haben Sie es schon einmal bemerkt. Wenn Sie auf eine  Diskette schreiben wollen, bei der der Schreibschutz gesetzt    ist, erscheint eine Alert-Box, aber ohne Maus, sodaû Sie den    ABBRUCH-Knopf nur durch geduldiges Experimentieren mit der Maus erreichen kînnen. Diese Box wird vom Betriebssystem ohne unser  Zutun und ohne Einwirkungsmîglichkeit erzeugt.                 NEWVECTOR Ñndert den zugehîrigen Vector (critical error handler) so, daû diese Boxen nicht mehr erscheinen, wohl aber die, in    denen z.B. zum Diskettenwechsel aufgefordert wird.             SETVEC und RESTVEC dienen zum Umschalten zwischen altem und      neuen Vector.                                                  Insbesondere muû BYE den alten Vector wiederherstellen, sonst    stÅrzt das System gnadenlos ab.                                Noch keine besonders elegante Lîsung, aber besser als keine !!  